@model ERP.Web.Service.ViewModels.ExamSearchListViewModel_result

<!-- Excel 檔案上傳區 -->
<form id="uploadForm" enctype="multipart/form-data">
    <input type="file" id="fileInput" name="file" accept=".xlsx, .xls" />
    <button type="submit">上傳 Excel</button>
</form>

<form method="get" action="@Url.Action("Test", "Exam")">
    <label for="Class">科目：</label>
    <select id="TestType" name="TestType">
        @foreach (var testType in Model.TestTypeList)
        {
            <option value="@testType.Value">@testType.Text</option>
        }
    </select>
    <label for="Class">選擇考卷：</label>
    <select id="Class" name="Class">
        @foreach (var className in Model.ClassNameList)
        {
            <option value="@className">@className</option>
        }
    </select>
    <label for="CorrectType">選擇題目類型：</label>
    <select id="CorrectType" name="CorrectType">
        @foreach (var item in Model.CorrectList)
        {
            <option value="@item.Value">@item.Text</option>
        }
    </select>
    <label for="KidID">選擇學生：</label>
    <select id="KidID" name="KidID">
        @foreach (var kid in Model.KidList)
        {
            <option value="@kid.Value">@kid.Text</option>
        }
    </select>
    @* <label for="SelectDate">選擇日期：</label>
    <select id="SelectDate" name="SelectDate">
        @foreach (var Date in Model.DateList)
        {
            <option value="@Date.Value">@Date.Text</option>
        }
    </select> *@

    <button type="submit">送出</button>
</form>

<!-- 狀態訊息 -->
<p id="uploadStatus"></p>

<hr />


<div class="row">
    <div class="col-lg-12">
        <div class="ibox">
            <div id="partial" class="ibox-content ibox-list-content">
                <partial name="_SearchList" model="Model"><partial />
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#uploadForm").submit(function (e) {
            e.preventDefault(); // 防止表單提交

            var formData = new FormData();
            var fileInput = $("#fileInput")[0].files[0];

            if (!fileInput) {
                $("#uploadStatus").text("請選擇 Excel 檔案");
                return;
            }

            formData.append("file", fileInput);

            $.ajax({
                url: "@Url.Action("Upload", "Exam")",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    $("#uploadStatus").text("上傳成功！");
                },
                error: function () {
                    $("#uploadStatus").text("上傳失敗，請重試");
                }
            });
        });

        $(document).on("change", "#Class, #CorrectType, #KidID", function () {
        var ClassName = $("#Class").val();
        console.log("ClassName 改變為:", ClassName);
        var CorrectType = $("#CorrectType").val();
        var KidID = $("#KidID").val();
            $.ajax({
                    url: '@Url.Action("GetList")',
                    type: 'GET',
                    data: {
                        ClassName: ClassName, 
                        CorrectType: CorrectType, 
                        KidID: KidID
                    }
                }).done(function (result) {
                    $('#partial').html(result);
                });
        });

        var callback = function () {
        var ClassName = $("#Class").val();
        var CorrectType = $("#CorrectType").val();
        var KidID = $("#KidID").val();
            return {
                method: "get",
                url: '@Url.Action("GetList")',
                footable: true,
                data: {
                    ClassName: ClassName,
                    CorrectType: CorrectType,
                    KidID: KidID
                }
            };
        };
        PageTurning(callback);

    });


</script>
